var CjQuizAdminFactory = {};

(function($){
	CjQuizAdminFactory.init = function(){
		$('.tooltip-hover').tooltip();
		$(".collapse").collapse();

		$('div.btn-group[data-toggle-name]').each(function(){
			var group   = $(this);
		    var field   = group.closest('.controls');
		    var name    = group.attr('data-toggle-name');
		    var hidden  = field.find('input[name="' + name + '"]');
		    
		    $('button', group).each(function(){
		    	var button = $(this);
		    	button.live('click', function(){
		    		hidden.val($(this).val());
		    		group.find('button').attr('class', 'btn');
		    		$(this).addClass($(this).attr('data-toggle-class'));
		    	});

		    	if(button.val() == hidden.val()) {
		    		button.addClass($(this).attr('data-toggle-class'));
		    	}
		    });
		});
		
		$('body').on('mouseover', '.tooltip-hover', function(){$(this).tooltip('show');});
	};
	
	CjQuizAdminFactory.init_quizzes = function(){
		$('.btn-publish').click(function(event){
			event.preventDefault();
			var button = $(this).addClass('btn-progress');
			$.ajax({
				url: (button.hasClass('btn-success') ? $('#url-unpublish-quiz').text() : $('#url-publish-quiz').text()),
				dataType: 'json',
				data: {'cid': button.parent().find('input').val()},
				success: function(data, status, xhr, form){
					if(typeof data.error != 'undefined' && data.error.length > 0){
						$('#message-modal').find('.modal-body').html(data.error);
						$('#message-modal').modal('show');
					}else{
						button.toggleClass('btn-success').toggleClass('btn-danger');
						button.find('i').toggleClass('icon-ok').toggleClass('icon-remove');
					}
					button.removeClass('btn-progress');
				}
			});
			return false;
		});
		
		$('.btn-reset').click(function(){
			$(this).closest('.input-append').find('input[type="text"]').val('');
			$(this).closest('form').submit();
		});
	};
	
})(jQuery);

jQuery(document).ready(function($){
	CjQuizAdminFactory.init();
	var pageid = $('#cjquiz_page_id').val();
	if(pageid == 'quizzes') CjQuizAdminFactory.init_quizzes();
});